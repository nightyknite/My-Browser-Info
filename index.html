<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>My Browser Info</title>
	<style>
	#app {text-align: center}
	h1 {font-size: 100%}
	table,tr,td {with:100%}
	dl,
	dt,
	dd {
	  box-sizing: border-box;
	}
	dl {
	  background: #FAFAD2;
	  border-right: 1px solid #ccc;
	  border-bottom: 1px solid #ccc;
	  border-left: 1px solid #ccc;
	}
	dt,
	dd {
	  border-top: 1px solid #ccc;
	}
	dt {
	  width: 40%;
	  float: left;
	}
	dd {
	  background: #fff;
	  margin-left: 40%;
	  border-left: 1px solid #ccc;
	}
	dd:after {
	  content: '';
	  display: block;
	  clear: both;
	}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.1.1/es6-promise.auto.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.1/axios.min.js"></script>
</head>
<body>

<div id="app">
	<h1>My Browser Info</h1>

<dl>
    <dt>Public IP</dt>
    <dd>{{ public_ip }}</dd>
    <dt>Private IP</dt>
    <dd>{{ private_ip }}</dd>
    <dt>Accept-Language</dt>
    <dd>{{ accept_language }}</dd>
    <dt>Platform</dt>
    <dd>{{ platform }}</dd>
    <dt>Screen Width</dt>
    <dd>{{ screen_width }}</dd>
    <dt>Screen Height</dt>
    <dd>{{ screen_height }}</dd>
    <dt>緯度(latitude)</dt>
    <dd>{{ latitude }}</dd>
    <dt>経度(longitude)</dt>
    <dd>{{ longitude }}</dd>
    <dt>Google Map</dt>
    <dd> <img v-bind:src="mapimage_url" ></dd>
    
    <dt>UserAgent</dt>
    <dd>{{ user_agent }}</dd>
    <dt>OS</dt>
    <dd>{{ os }}</dd>

    <dt>Browser</dt>
    <dd>{{ browser }}</dd>

    <dt>スマートフォン/タブレット</dt>
    <dd>{{ mobile_type }}</dd>

    <dt>Vendor Fragments</dt>
    <dd>{{ vendor_fragments }}</dd>

    
    
</dl>
</div>
<script>
var app = new Vue({
  el: '#app',
  data: {
    user_agent : '',
    accept_language : '',
    platform : '',
    screen_width : '',
    public_ip : '',
    private_ip : '',
    screen_height : '',
    latitude : '',
    longitude : '',
    mapimage_url : '',
    os : '',
    browser : '',
    mobile_type : '',
    vendor_fragments : ''
  },
  created: function () {

	axios.get("https://api.ipify.org/?format=json")
    	.then(response => {this.public_ip = response.data.ip})

    this.user_agent = navigator.userAgent;

    this.accept_language = navigator.languages;
    
    this.platform = navigator.platform;

    this.screen_width = parent.screen.width;
    this.screen_height = parent.screen.height;

    // geolocation
    navigator.geolocation.getCurrentPosition( function(position){
        app.latitude = position.coords.latitude;
        app.longitude = position.coords.longitude;

    app.mapimage_url  = "https://maps.googleapis.com/maps/api/staticmap?center=" + app.latitude + "," + app.longitude + "&zoom=13&size=300x300&sensor=false";


    } , function(){} , {} );

    var ua = navigator.userAgent.toLowerCase();

    // OS
    var os = "n/a";
    if (ua.indexOf("iphone") > 0) {
        os = "iPhone";
    } else if (ua.indexOf("ipad") > 0) {
        os = "iPad";
    } else if (ua.indexOf("ipod") > 0) {
        os = "iPod";
    } else if (ua.indexOf("android") > 0) {
        os = ua.match(/android [0-9.]*/gi)[0];
    } else if (ua.indexOf("windows nt 6.1") > 0) {
        os = "Windows7";
    } else if (ua.indexOf("windows nt 6.2") > 0) {
        os = "Windows8";
    } else if (ua.indexOf("windows nt 6.3") > 0) {
        os = "Windows8.1";
    } else if (ua.indexOf("windows nt 10.0") > 0) {
        os = "Windows10";
    } else if (ua.indexOf("windows") > 0) {
        os = "Windows";
    } else if ((ua.indexOf("mac os x 10_9") > 0) || (ua.indexOf("mac os x 10.9") > 0)) {
        os = "MacOS X 10.9 Mavericks";
    } else if ((ua.indexOf("mac os x 10_10") > 0) || (ua.indexOf("mac os x 10.10") > 0)) {
        os = "MacOS X 10.10 Yosemite";
    } else if ((ua.indexOf("mac os x 10_11") > 0) || (ua.indexOf("mac os x 10.11") > 0)) {
        os = "MacOS X 10.11 El Capitan";
    } else if ((ua.indexOf("mac os x 10_12") > 0) || (ua.indexOf("mac os x 10.12") > 0)) {
        os = "MacOS X 10.12 Sierra";
    } else if ((ua.indexOf("mac os x 10_13") > 0) || (ua.indexOf("mac os x 10.13") > 0)) {
        os = "MacOS X 10.13 High Sierra";
    } else if (ua.indexOf("mac") > 0) {
        os = "Mac";
    } else if (ua.indexOf("linux") > 0) {
        os = "Linux";
    }

    this.os = os;

    // Browser
    var browser = "n/a";

    if (ua.indexOf("iphone") > 0) {
        browser = "iPhone";
    } else if (ua.indexOf("ipad") > 0) {
        browser = "iPad";
    } else if (ua.indexOf("ipod") > 0) {
        browser = "iPod";        
    } else if (ua.indexOf("trident/7.0") > 0) {
        browser = "IE11";
    } else if (ua.indexOf("edge") > 0) {
        browser = "MicroSoft Edge";
    } else if (ua.indexOf("firefox") > 0) {
        browser = ua.match(/firefox\/[0-9.]*/gi)[0];        
    } else if (ua.indexOf("opr") > 0) {
        browser = "Opera";
    } else if (ua.indexOf("chrome") > 0) {
        browser = ua.match(/chrome\/[0-9.]*/gi)[0];
    } else if (ua.indexOf("safari") > 0) {
        browser = "Safari";
    }

    this.browser = browser;


    // mobile type 
    var mobile_type = "n/a";

    if (ua.indexOf('iphone') > 0 
        || ua.indexOf('ipod') > 0 
        || ua.indexOf('windows phone') > 0
        || ua.indexOf('blackberry') > 0
        || (ua.indexOf('android') > 0 && ua.indexOf('mobile') > 0)
        ) {

       mobile_type = "スマートフォン";

    } else if (ua.indexOf('ipad') > 0
        || ua.indexOf('kindle') > 0
        || ua.indexOf('Silk') > 0 
        || (ua.indexOf('android') > 0 && ua.indexOf('tablet') > 0)
        || (ua.indexOf('windows') > 0 && ua.indexOf('touch') > 0)
        ) {

        mobile_type = "タブレット";

    }

    this.mobile_type = mobile_type;

    // vendor_fragments

    axios.get("vendor_fragments.json")
        .then(response => {
            for (var item in response.data) {
                if (ua.indexOf(item.toLowerCase()) > 0) {
                  app.vendor_fragments = item + ':' + response.data[item].title;
                  break;
                }
            }
        }   
    )

    
    // Private IP
    // https://stackoverflow.com/questions/20194722/can-you-get-a-users-local-lan-ip-address-via-javascript
    window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;//compatibility for Firefox and chrome
    var pc = new RTCPeerConnection({iceServers:[]}), noop = function(){};      
    pc.createDataChannel('');//create a bogus data channel
    pc.createOffer(pc.setLocalDescription.bind(pc), noop);// create offer and set local description
    pc.onicecandidate = function(ice)
    {
     if (ice && ice.candidate && ice.candidate.candidate)
     {
      var myIP = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1];
          app.private_ip = myIP; 
          pc.onicecandidate = noop;
     }
    };


  }

})
</script>
</body>
</html>
